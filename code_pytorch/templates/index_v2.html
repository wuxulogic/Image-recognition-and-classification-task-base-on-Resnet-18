<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾åƒè¯†åˆ«åº”ç”¨</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
        }
        .file-input-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        /* ä¿®å¤æ‚¬åœæ•ˆæœï¼šå½“çˆ¶å…ƒç´ æ‚¬åœæ—¶ï¼Œæ”¹å˜æŒ‰é’®çš„èƒŒæ™¯è‰² */
        .file-input-wrapper:hover #select-button {
            background-color: #2563eb; /* Tailwind's blue-600 */
        }
        /* ç±»åˆ«å¡ç‰‡é«˜äº®åŠ¨ç”» */
        .card-highlight {
            animation: pulse-highlight 1.5s infinite;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.5); /* green-500 with opacity */
        }
        @keyframes pulse-highlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        /* æŒ‰é’®ç‚¹å‡»åŠ¨ç”» */
        .btn-press {
            animation: press-effect 0.2s ease-in-out;
        }
        @keyframes press-effect {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

<div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full text-center">
    <h1 class="text-3xl font-semibold text-gray-800 mb-2">å›¾åƒè¯†åˆ«</h1>
    <p class="text-gray-600 mb-6">ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œè®©æˆ‘æ¥çŒœçŒœå®ƒæ˜¯ä»€ä¹ˆï¼</p>

    <!-- å¯è¯†åˆ«çš„ç±»åˆ«åˆ—è¡¨ -->
    <div class="mb-6">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">å¯è¯†åˆ«çš„ç±»åˆ«ï¼š</h2>
        <div id="class-cards" class="grid grid-cols-3 sm:grid-cols-5 gap-3">
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="é£æœº">
                <span class="text-2xl mb-1">âœˆï¸</span>
                <span class="text-sm">é£æœº</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="æ±½è½¦">
                <span class="text-2xl mb-1">ğŸš—</span>
                <span class="text-sm">æ±½è½¦</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="é¸Ÿ">
                <span class="text-2xl mb-1">ğŸ¦</span>
                <span class="text-sm">é¸Ÿ</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="çŒ«">
                <span class="text-2xl mb-1">ğŸ±</span>
                <span class="text-sm">çŒ«</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="é¹¿">
                <span class="text-2xl mb-1">ğŸ¦Œ</span>
                <span class="text-sm">é¹¿</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="ç‹—">
                <span class="text-2xl mb-1">ğŸ¶</span>
                <span class="text-sm">ç‹—</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="é’è›™">
                <span class="text-2xl mb-1">ğŸ¸</span>
                <span class="text-sm">é’è›™</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="é©¬">
                <span class="text-2xl mb-1">ğŸ´</span>
                <span class="text-sm">é©¬</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="èˆ¹">
                <span class="text-2xl mb-1">â›µ</span>
                <span class="text-sm">èˆ¹</span>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg flex flex-col items-center justify-center text-gray-700 hover:bg-gray-100 transition-colors duration-200" data-class="å¡è½¦">
                <span class="text-2xl mb-1">ğŸšš</span>
                <span class="text-sm">å¡è½¦</span>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
    <div id="image-preview" class="w-full h-auto min-h-[12rem] bg-gray-200 rounded-xl mb-6 flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-400">
        <span id="placeholder-text" class="text-gray-500">å›¾ç‰‡é¢„è§ˆ</span>
    </div>

    <!-- ä¸Šä¼ å’Œé¢„æµ‹æŒ‰é’® -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
        <div class="flex-1 file-input-wrapper">
            <button id="select-button" class="w-full bg-blue-500 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200">
                é€‰æ‹©å›¾ç‰‡
            </button>
            <input type="file" id="file-upload" accept="image/*">
        </div>
        <button id="predict-button" class="flex-1 bg-green-500 text-white font-medium py-3 px-6 rounded-lg hover:bg-green-600 transition-colors duration-200" disabled>
            å¼€å§‹é¢„æµ‹
        </button>
    </div>

    <!-- æ–°å¢çš„æ˜¾ç¤ºè¯¦ç»†æ•°æ®æŒ‰é’® -->
    <button id="show-details-button" class="w-full bg-gray-500 text-white font-medium py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors duration-200 mt-4 hidden">
        æ˜¾ç¤ºè¯¦ç»†æ•°æ®
    </button>
    <div class="h-4"></div>

    <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
    <div id="results" class="hidden">
        <div id="predicted-class" class="text-2xl font-bold text-gray-700 mb-4"></div>
        <div id="confidence" class="text-lg text-gray-600 mb-6"></div>

        <h3 class="text-md font-semibold text-gray-700 mb-2">æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡ï¼š</h3>
        <div id="all-predictions" class="space-y-2 text-left"></div>
    </div>

    <!-- ä½œè€…ä¿¡æ¯ -->
    <div class="mt-8 pt-4 border-t border-gray-200 text-center text-gray-500 text-sm">
        <p>è¿™ä¸ªé¡¹ç›®ç”± 4 ä½ä½œè€…å…±åŒå®Œæˆã€‚</p>
        <p>1.å¸¸å­è¡¡ï¼Œ2.ç‹åŠŸå‚²ï¼Œ3.é èµ«é“­ï¼Œ4.æäºšæ¶µ<p>
    </div>
</div>

<script>
    const fileUpload = document.getElementById('file-upload');
    const selectButton = document.getElementById('select-button');
    const imagePreview = document.getElementById('image-preview');
    const predictButton = document.getElementById('predict-button');
    const showDetailsButton = document.getElementById('show-details-button');
    const resultsDiv = document.getElementById('results');
    const predictedClassDiv = document.getElementById('predicted-class');
    const confidenceDiv = document.getElementById('confidence');
    const allPredictionsDiv = document.getElementById('all-predictions');
    const placeholderText = document.getElementById('placeholder-text');
    const classCards = document.querySelectorAll('#class-cards > div');

    // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»
    selectButton.addEventListener('click', () => {
        selectButton.classList.add('btn-press');
        setTimeout(() => selectButton.classList.remove('btn-press'), 200);
    });
    predictButton.addEventListener('click', () => {
        predictButton.classList.add('btn-press');
        setTimeout(() => predictButton.classList.remove('btn-press'), 200);
    });
    showDetailsButton.addEventListener('click', () => {
        showDetailsButton.classList.add('btn-press');
        setTimeout(() => showDetailsButton.classList.remove('btn-press'), 200);
    });

    fileUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="å›¾ç‰‡é¢„è§ˆ" class="max-w-full max-h-full object-contain mx-auto rounded-xl">`;
                predictButton.disabled = false;
                showDetailsButton.classList.add('hidden'); // éšè—è¯¦ç»†æ•°æ®æŒ‰é’®
                resultsDiv.classList.add('hidden'); // éšè—æ—§çš„ç»“æœ
            };
            reader.readAsDataURL(file);
        } else {
            imagePreview.innerHTML = `<span class="text-gray-500">å›¾ç‰‡é¢„è§ˆ</span>`;
            predictButton.disabled = true;
            showDetailsButton.classList.add('hidden');
            resultsDiv.classList.add('hidden');
        }
    });

    predictButton.addEventListener('click', async () => {
        const file = fileUpload.files[0];
        if (!file) {
            alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼');
            return;
        }

        // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„é«˜äº®æ•ˆæœ
        classCards.forEach(card => card.classList.remove('card-highlight'));

        const formData = new FormData();
        formData.append('image', file);

        predictButton.disabled = true;
        predictButton.textContent = 'é¢„æµ‹ä¸­...';

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                body: formData,
            });

            if (!response.ok) {
                throw new Error(`HTTP é”™è¯¯ï¼çŠ¶æ€ç : ${response.status}`);
            }

            const data = await response.json();
            
            // æ˜¾ç¤ºä¸»è¦ç»“æœ
            predictedClassDiv.textContent = data.class;
            confidenceDiv.textContent = `ç½®ä¿¡åº¦: ${(data.confidence * 100).toFixed(2)}%`;

            // é«˜äº®æ˜¾ç¤ºé¢„æµ‹ç»“æœ
            const predictedClass = data.class;
            const predictedCard = document.querySelector(`[data-class="${predictedClass}"]`);
            if (predictedCard) {
                predictedCard.classList.add('card-highlight');
            }

            // å¡«å……æ‰€æœ‰é¢„æµ‹ç»“æœ
            allPredictionsDiv.innerHTML = '';
            data.predictions.sort((a, b) => b[1] - a[1]).forEach(prediction => {
                const [className, confidence] = prediction;
                const confidencePercent = (confidence * 100).toFixed(2);
                const barWidth = confidence * 100;
                const barColor = confidence === data.confidence ? 'bg-green-500' : 'bg-blue-300';
                
                const item = document.createElement('div');
                item.className = 'flex items-center space-x-2';
                item.innerHTML = `
                    <div class="w-24 text-right text-sm text-gray-600">${className}</div>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div class="h-4 rounded-full ${barColor} transition-all duration-300" style="width: ${barWidth}%;"></div>
                    </div>
                    <div class="w-12 text-sm text-gray-700">${confidencePercent}%</div>
                `;
                allPredictionsDiv.appendChild(item);
            });

            // é¢„æµ‹å®Œæˆåï¼Œæ˜¾ç¤ºâ€œæ˜¾ç¤ºè¯¦ç»†æ•°æ®â€æŒ‰é’®
            showDetailsButton.classList.remove('hidden');

        } catch (error) {
            console.error('é¢„æµ‹å¤±è´¥:', error);
            alert(`é¢„æµ‹å¤±è´¥: ${error.message}`);
        } finally {
            predictButton.disabled = false;
            predictButton.textContent = 'å¼€å§‹é¢„æµ‹';
        }
    });

    // ä¸ºæ–°çš„â€œæ˜¾ç¤ºè¯¦ç»†æ•°æ®â€æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
    showDetailsButton.addEventListener('click', () => {
        if (resultsDiv.classList.contains('hidden')) {
            resultsDiv.classList.remove('hidden');
            showDetailsButton.textContent = 'éšè—è¯¦ç»†æ•°æ®';
        } else {
            resultsDiv.classList.add('hidden');
            showDetailsButton.textContent = 'æ˜¾ç¤ºè¯¦ç»†æ•°æ®';
        }
    });
</script>
</body>
</html>
